"use strict";function w(r,a){let c=[];const l=new Set,o=y(r),d=()=>o,i=e=>{if(e.call)return l.add(e),()=>{l.delete(e)};{const n=(s,{action:t,payload:u})=>{t in e&&e[t].call(null,s,{action:t,payload:u})};return l.add(n),()=>{l.delete(n)}}},p=(e,n)=>(c.push({action:e,payload:n}),new Promise(s=>g({action:e,payload:n},s))),f=e=>new Promise(n=>{i((s,{action:t,payload:u})=>{t in e&&S(h=>{e[t].call(null,s,{action:t,payload:u}),n(s)})})}),g=({action:e,payload:n={}},s)=>{c.forEach(({action:t,payload:u={}})=>{if(!(t in a))console.log(`[Oni] Error -> No action [ ${t} ] found.`);else{const h=a[t].call(null,o,u,{getState:d,subscribe:i,dispatch:p,patternMatch:f});Object.assign(o,h)}}),c.length&&(l.forEach(t=>t(o,{action:e,payload:n})),c=[]),s(o)};return{getState:d,subscribe:i,dispatch:p,patternMatch:f,destroy:()=>l.clear()}}const y=r=>JSON.parse(JSON.stringify(r)),S=typeof window>"u"?r=>r():r=>requestAnimationFrame(r);module.exports=w;
