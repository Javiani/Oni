"use strict";function y(n,d){let c=[];const i=new Set,o=S(n),p=()=>o,l=e=>{if(e.call)return i.add(e),()=>{i.delete(e)};u(e)},f=(e,s)=>(c.push({action:e,payload:s}),new Promise(r=>g(t=>w({action:e,payload:s},r)))),u=e=>new Promise(s=>{l((r,{action:t,payload:a})=>{t in e&&g(h=>{e[t].call(null,r,{action:t,payload:a}),s(r)})})}),w=({action:e,payload:s={}},r)=>{c.forEach(({action:t,payload:a={}})=>{if(!(t in d))console.log(`[Oni] Error -> No action [ ${t} ] found.`);else{const h=d[t].call(null,o,a,{getState:p,subscribe:l,dispatch:f,patternMatch:u});Object.assign(o,h)}}),c.length&&(i.forEach(t=>t(o,{action:e,payload:s})),c=[]),r(o)};return{getState:p,subscribe:l,dispatch:f,patternMatch:u,destroy:()=>i.clear()}}const S=n=>JSON.parse(JSON.stringify(n)),g=typeof window>"u"?n=>n():n=>requestAnimationFrame(n);module.exports=y;
