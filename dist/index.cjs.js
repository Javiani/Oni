"use strict";function y(r,a){let c=[];const l=new Set,o=S(r),d=()=>o,i=t=>{if(t.call)return l.add(t),()=>{l.delete(t)};{const n=(s,{action:e,payload:u})=>{e in t&&t[e].call(null,s,{action:e,payload:u})};return()=>{l.delete(n)}}},p=(t,n)=>(c.push({action:t,payload:n}),new Promise(s=>g(e=>w({action:t,payload:n},s)))),f=t=>new Promise(n=>{i((s,{action:e,payload:u})=>{e in t&&g(h=>{t[e].call(null,s,{action:e,payload:u}),n(s)})})}),w=({action:t,payload:n={}},s)=>{c.forEach(({action:e,payload:u={}})=>{if(!(e in a))console.log(`[Oni] Error -> No action [ ${e} ] found.`);else{const h=a[e].call(null,o,u,{getState:d,subscribe:i,dispatch:p,patternMatch:f});Object.assign(o,h)}}),c.length&&(l.forEach(e=>e(o,{action:t,payload:n})),c=[]),s(o)};return{getState:d,subscribe:i,dispatch:p,patternMatch:f,destroy:()=>l.clear()}}const S=r=>JSON.parse(JSON.stringify(r)),g=typeof window>"u"?r=>r():r=>requestAnimationFrame(r);module.exports=y;
