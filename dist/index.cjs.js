"use strict";function b(s,p){let c=[];const i=new Set,r=y(s),f=()=>r,l=e=>e.call?(i.add(e),()=>{i.delete(e)}):()=>{a(e).then(({__unsubscribe:n})=>n())},h=(e,n)=>(c.push({action:e,payload:n}),new Promise(u=>g(t=>w({action:e,payload:n},u)))),a=e=>new Promise(n=>{let u=l((t,{action:o,payload:d})=>{o in e&&g(_=>{e[o].call(null,t,{action:o,payload:d}),t.__unsubscribe=u,n(t)})})}),w=({action:e,payload:n={}},u)=>{c.forEach(({action:t,payload:o={}})=>{if(!(t in p))console.log(`[Oni] Error -> No action [ ${t} ] found.`);else{const d=p[t].call(null,r,o,{getState:f,subscribe:l,dispatch:h,patternMatch:a});Object.assign(r,d)}}),c.length&&(i.forEach(t=>t(r,{action:e,payload:n})),c=[]),u(r)};return{getState:f,subscribe:l,dispatch:h,patternMatch:a,destroy:()=>i.clear()}}const y=s=>JSON.parse(JSON.stringify(s)),g=typeof window>"u"?s=>s():s=>requestAnimationFrame(s);module.exports=b;
